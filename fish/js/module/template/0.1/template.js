(function(){function p(a,d,b){return(typeof d==="string"?d:d.toString()).replace(a.define||k,function(i,c,g,e){if(c.indexOf("def.")===0)c=c.substring(4);if(!(c in b))if(g===":")b[c]=e;else eval("def['"+c+"']="+e);return""}).replace(a.use||k,function(i,c){var g=eval(c);if(c==="def.temp")throw Error("forbin def.temp in template");return g?p(a,g,b):g})}function m(a){return a.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var h={version:"0.2.0",templateSettings:{evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,
encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:true,append:true,selfcontained:false},cache:{},template:undefined},q={append:{start:"'+(",end:")+'",startencode:"'+fish.encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=fish.encodeHTML("}},k=/$^/;h.template=function(a,
d){var b=h.templateSettings,i,c,g=b.append?q.append:q.split,e,j=0,n;if(d){e=p(b,a,d);if(!(c=h.cache[e]))i=e}else if(!(c=h.cache[a])){i=a;e=p(b,a,{})}c||(e=("var out='"+(b.strip?e.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):e).replace(/'|\\/g,"\\$&").replace(b.interpolate||k,function(o,f){return g.start+m(f)+g.end}).replace(b.encode||k,function(o,f){return g.startencode+m(f)+g.end}).replace(b.conditional||k,function(o,f,l){return f?l?"';}else if("+m(l)+"){out+='":
"';}else{out+='":l?"';if("+m(l)+"){out+='":"';}out+='"}).replace(b.iterate||k,function(o,f,l,r){if(!f)return"';} } out+='";j+=1;n=r||"i"+j;f=m(f);return"';var arr"+j+"="+f+";if(arr"+j+"){var "+l+","+n+"=-1,l"+j+"=arr"+j+".length-1;while("+n+"<l"+j+"){"+l+"=arr"+j+"["+n+"+=1];out+='"}).replace(b.evaluate||k,function(o,f){return"';"+m(f)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|}|^|{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|}|^|{)out\+=''\+/g,
"$1out+="));try{if(!c){c=new Function(b.varname,e);h.cache[i]=c}return c}catch(s){typeof console!=="undefined"&&console.log("Could not create a template function: "+e);throw s;}};fish.extend({template:function(a,d){var b=a.temp;if(typeof a==="string")return d?h.template(a)(d):h.template(a);else if(typeof a==="object"){fish.lang.extend(h.templateSettings,a);return d?h.template(b,a)(d):h.template(b,a)}},encodeHTML:function(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},
d=/&(?!#?\w+;)|<|>|"|'|\//g;return function(b){return b?b.toString().replace(d,function(i){return a[i]||i}):b}}()})})();
