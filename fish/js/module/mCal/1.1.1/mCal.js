(function(){function y(a){var b=document.createElement("div"),c=[];fish.all(b).html(a);for(a=0;a<b.childNodes.length;a++)b.childNodes[a].nodeType===1&&c.push(b.childNodes[a]);return fish.all(c)}function z(a){a=a||{};var b=function(){};b={css:"",tableThCss:"",userDateCss:"",dateCss:"",itemCss:"",width:0,height:0,open:false,startTime:fish.parseTime(new Date),endTime:"2099-01-01",inputElem:fish.dom(this),formatInputElemAtStart:false,showPast:false,showDay:false,showMonthOnBtn:false,showSpecDate:true,
now:"",focus:fish.parseTime(new Date),eachHeight:28,eachWidth:28,monthNum:2,backgroundMonthnumSize:160,enableBtnWhenOutOfRange:true,ajaxUrl:"",bodyTemp:'<iframe class="if" src="http://img1.40017.cn/cn/new_ui/public/images/png_cover.png"></iframe><div class="date"><div class="top clearfix"></div><div class="calCanvas"></div></div>',titleTemp:'<div class="floatL monthTitle"><h4 class="lastText  mCalTitleFir" ><span class="date_title">...</span></h4></div>',prevBtnTemp:'<span class="lastMonthBg date_lastSpan"><span class="lastMonth"></span><span class="monthNum"></span></span>',
nextBtnTemp:'<span class="nextMonthBg date_nextSpan"><span class="nextMonth"></span><span class="monthNum"></span></span>',cache:{},__ajaxObjs:{},fn:b,jsonpCallback:null,ajaxFn:b,monthChangeStyle:"",_monthTimes:1,mouseover:b,mouseout:b,beforeOpen:b,afterClose:b,beforePrevFn:b,afterPrevFn:b,beforeNextFn:b,afterNextFn:b,processDataFn:b,dateTempleteFn:b,dateClickAbleFn:b,fillBlank:false,preLoadingUserData:false,calTitleFn:false,cachAjax:true};var c=fish.lang.proto(mCalFn);fish.lang.extend(b,a);fish.lang.extend(c,
b);return c.init(a)}function m(a){a=fish.parseDate(a,{months:1});a.setDate(0);return a.getDate()}function r(a,b){var c=fish.parseDate(a);c.setDate(1);b=b||"chinese";if(b=="chinese")return x.charAt(c.getDay());else if(b=="number")return c.getDay()}function C(a,b,c){var d=fish.parseDate(a),e=fish.parseDate(a);b=fish.parseDate(b);c=fish.parseDate(c);d.setDate(1);d.setHours(0);d.setMinutes(0);c.setHours(23);c.setMinutes(59);e.setDate(m(a));e.setHours(23);e.setMinutes(59);a=d.getTime();e=e.getTime();b=
b.getTime();c=c.getTime();b=[a,e,b,c].sort(function(g,f){return g-f});return b[1]===c||b[1]===e?{start:0,end:0}:{start:(new Date(b[1])).getDate(),end:(new Date(b[2])).getDate()}}function D(a){a=a||{};var b=function(){};b={width:0,cal:"",now:"",today:"",tomorrow:"",tableThCss:"",month:fish.parseTime(new Date),eachHeight:28,eachWidth:28,__elem:null,dataUrl:"",fn:b,ajaxFn:b,showPast:false,mouseover:b,mouseout:b,type:"json",calTemp:function(){var d=[],e;d.push('<div class="contentTime clearfix"><table cellspacing="0" cellpadding="0" border="0" ><tbody><tr>');
x.split("").forEach(function(h){d.push("<th "+(h==="\u516d"?"class='sat'":h==="\u65e5"?"class='sun'":"")+" >"+h+"</th>")});d.push("</tr>");for(var g=0;g<6;g++){d.push('<tr calweek="'+(g+1)+'">');for(var f=0;f<7;f++){e=x.charAt(f);d.push('<td><div calday="'+e+'" class="itemWrap '+(e==="\u516d"?"sat":e==="\u65e5"?"sun":"")+'"><span class="dateWrap">&nbsp;</span><div class="userWrap"></div></div></td>')}d.push("</tr>")}d.push('</tbody></table><i class="monthBg"></i></div>');return d.join("")}(),reloadData:false,
startDate:1,endDate:31,firstDay:"",processDataFn:b,dateTempleteFn:b,startTime:"1970-01-01",endTime:"2099-01-01"};var c=fish.lang.proto(mMonthFn);fish.lang.extend(b,a);fish.lang.extend(c,b);c.init();return c}function E(a){a=parseInt(a);if(a<10)a="0"+a;return a+""}var A={"2013-01-01":{name:"\u5143\u65e6"},"2013-02-09":{name:"\u9664\u5915"},"2013-02-10":{name:"\u6625\u8282"},"2013-02-24":{name:"\u5143\u5bb5"},"2013-04-04":{name:"\u6e05\u660e"},"2013-05-01":{name:"5.1"},"2013-06-01":{name:"6.1"},"2013-06-12":{name:"\u7aef\u5348"},
"2013-08-13":{name:"\u4e03\u5915"},"2013-09-19":{name:"\u4e2d\u79cb"},"2013-10-01":{name:"\u56fd\u5e86"},"2013-12-25":{name:"\u5723\u8bde"},"2014-01-01":{name:"\u5143\u65e6"},"2012-04-04":{name:"\u6e05\u660e"},"2012-05-01":{name:"5.1"},"2012-06-01":{name:"6.1"},"2012-06-23":{name:"\u7aef\u5348"},"2012-08-23":{name:"\u4e03\u5915"},"2012-09-30":{name:"\u4e2d\u79cb"},"2012-10-01":{name:"\u56fd\u5e86"},"2012-12-25":{name:"\u5723\u8bde"}},p={},F=fish.browser("ms",6),G=fish.browser("ms",7),x="\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d";
fish.one(window).on("resize",function(){for(var a in p)if(p.hasOwnProperty(a)){var b=p[a],c,d;if(b.__calElem){c=fish.one(b.__calElem);if(F||G)(function(e,g){g.length>0&&setTimeout(function(){(d=g.getCss("display")=="none"?false:true)&&e.show(false,true)},0)})(b,c);else(d=c.getCss("display")=="none"?false:true)&&b.show(false,true)}}});var H=0;mCalFn={init:function(a){var b=this;if(this.inputElem&&(this.id=fish.all(this.inputElem).attr("data-mcalid"))&&p[this.id]){p[this.id].set(a);this.open&&p[this.id].show();
return p[this.id]}else{a=fish.browser();a=a.name==="ms"&&a.version<9?"static":"scroll";this.monthChangeStyle=this.monthChangeStyle?this.monthChangeStyle:a;this._monthTimes=this.monthChangeStyle==="scroll"?3:1;this.id=++H;this.__inputElem=fish.all(this.inputElem);this.__inputElem.attr("data-mcalid",this.id);this.__calElem=y("<div id='mCalendar"+this.id+"' class='mCalendar' style='position:absolute;display:block;top:0px;left:-1000px'></div>");fish.one("body").html("top",this.__calElem);this.__calElem.html("top",
this.bodyTemp);this.__topElem=fish.all(".top",this.__calElem);this.__topElem.html("top",this.prevBtnTemp);this.__topElem.html("top",this.nextBtnTemp);this.__canvasElem=fish.one(".calCanvas",this.__calElem);this.month=[];this.__monthHolderElem=fish.one(".date",this.__calElem);for(var c=0;c<this.monthNum;c++)this.__topElem.html("top",this.titleTemp);this.__monthTitleElem=fish.all(".monthTitle",this.__topElem);this._setNowAndFocus();var d,e;a=this.monthNum*(this.monthChangeStyle==="static"?1:3);var g=
this.monthChangeStyle==="static"?0:this.monthNum;for(c=0;c<a;c++)(function(f){b.month[c]=new D({width:d?d:0,height:e?e:0,cal:b,userDateCss:b.userDateCss,itemCss:b.itemCss,dateCss:b.dateCss,tableThCss:b.tableThCss,now:b.now,today:fish.parseTime(),month:fish.parseTime(b.focus,{months:c-g}),eachHeight:b.eachHeight,eachWidth:b.eachWidth,startTime:b.startTime,endTime:b.endTime,processDataFn:b.processDataFn,dateTempleteFn:b.dateTempleteFn,dateClickAbleFn:b.dateClickAbleFn,showPast:b.showPast,dataUrl:b.ajaxUrl,
type:b.type,jsonpCallback:b.jsonpCallback,fn:function(h){b._setFn(h,f)},mouseover:b.mouseover,mouseout:b.mouseout,fillBlank:b.fillBlank,preLoadingUserData:b.preLoadingUserData,__ajaxObjs:b.__ajaxObjs,cachAjax:b.cachAjax});b.month[c].insertTo(b.__canvasElem);d=b.month[c].width;e=b.month[c].height})(c);this.monthGroup={a:[],b:[],c:[],prev:"a",focus:"b",next:"c"};if(this.monthChangeStyle==="static")for(c=0;c<this.month.length;c++)this.monthGroup.b.push(this.month[c]);else if(this.monthChangeStyle===
"scroll")for(c=0;c<this.month.length;c++)if(c<this.monthNum)this.monthGroup.a.push(this.month[c]);else c<this.monthNum*2?this.monthGroup.b.push(this.month[c]):this.monthGroup.c.push(this.month[c]);this.__prevBtn=fish.one(".lastMonthBg",this.__calElem).on("click",function(){if(!b.__prevBtn.hasClass("clickDisable")){this.beforePrevFn&&this.beforePrevFn.call(b);b.goPrev()}});this.__prevBtnTips=fish.one(".monthNum",this.__prevBtn);this.__nextBtn=fish.one(".nextMonthBg",this.__calElem).on("click",function(){if(!b.__nextBtn.hasClass("clickDisable")){this.beforeNextFn&&
this.beforeNextFn.call(b);b.goNext()}});this.__nextBtnTips=fish.one(".monthNum",this.__nextBtn);this.set({},true);this.__monthTitleElem.css("width:"+this.month[0].width+"px");fish.all(this.elem).on("click",function(){b.show()});this.__inputElem.on("focus",function(){b.show()});this.__inputElem.on("mousedown",function(){b._calElemTouch=true});this.__inputElem.on("mouseup",function(){b._calElemTouch=false});this.__inputElem.on("blur",function(){setTimeout(function(){if(!b._calElemTouch){b.hide();this._calElemTouch=
false}},0)});a=fish.all([fish.dom(this.__calElem),fish.dom(this.__inputElem)]);if(this.elem){a[a.length]=fish.dom(this.elem);a.length++}switch(this.showType){case "pop":break;case "static":break;default:this.__calElem.effect({type:"click",elem:a,interShow:false,interFn:function(){fish.dom(b.__inputElem).blur()}})}this.__calElem.on("mousedown",function(){b._calElemTouch=true});this.__calElem.on("mouseup",function(){b._calElemTouch=false});b.setWH();b.open?b.show(false,true):b.hide();return p[this.id]=
this}},setWH:function(){var a=this.month[0].width*this.monthNum+4*(this.monthNum-1)-1;this.height=52+6*(this.eachHeight+2+1);this.__canvasElem.css("width:"+a+"px;height:"+this.month[0].height+"px");this.show(true);this.__monthHolderElem.css("width:"+a+"px;height:"+this.height+"px");this.width=a+4;this.height+=4;fish.one("iframe",this.__calElem).css("width:"+this.width+"px;height:"+this.height+"px");this.__calElem.css("width:"+this.width+"px;height:"+this.height+"px");this.hide()},_setNowAndFocus:function(){var a;
if(!this.now)this.now=fish.parseTime(fish.one(this.inputElem).val());this.formatInputElemAtStart&&fish.one(this.inputElem).val(this.now);a=fish.parseDate(this.now);a.setDate(1);this.focus=fish.parseTime(a)},setNow:function(a){this.now=a=fish.parseTime(a);fish.one(this.inputElem).val(a)},set:function(a,b){var c=this.monthChangeStyle==="static"?0:this.monthNum;a=a||{};var d=this;fish.lang.extend(this,a);this._setNowAndFocus();this.setMonthTitle();this.setMonthBtn();this.css&&this.__monthHolderElem.css(this.css);
if(!b)for(var e=0;e<this.month.length;e++)(function(g){d.month[e].setDate({now:d.now,today:fish.parseTime(),userDateCss:d.userDateCss,itemCss:d.itemCss,dateCss:d.dateCss,tableThCss:d.tableThCss,month:fish.parseTime(d.focus,{months:e-c}),startTime:d.startTime,endTime:d.endTime,showPast:d.showPast,processDataFn:d.processDataFn,dateTempleteFn:d.dateTempleteFn,dateClickAbleFn:d.dateClickAbleFn,dataUrl:d.ajaxUrl,fn:function(f){d._setFn(f,g)},mouseover:d.mouseover,mouseout:d.mouseout})})(e);if(this.monthChangeStyle===
"static")this._setStatic();else this.monthChangeStyle==="scroll"&&this._setScroll();this.monthGroup[this.monthGroup.focus].forEach(function(g){g.setUserDate()})},_setFn:function(a,b){var c=this,d;this.month.forEach(function(e){e.setNow(a)});d=this.month[b].getItemElem(fish.parseDate(a).getDate(),fish.parseDate(a).getMonth()+1);this.setValue(a);setTimeout(function(){c.hide()},0);this.fn&&this.fn.call(this,a,d)},setValue:function(a){this.now=fish.parseTime(a);this.__inputElem.val(this.now)},setMonth:function(a,
b){this.monthGroup[this.monthGroup[a]].forEach(function(c,d){c.setDate({month:fish.parseTime(b,{months:d})})})},setMonthUserDate:function(a){this.monthGroup[this.monthGroup[a]].forEach(function(b){b.setUserDate()})},show:function(a,b){var c=0,d=0,e=this;if(a)this.__calElem.css("position:absolute;display:block;top:0px;left:-1000px");else{var g=fish.one(this.inputElem).offset(),f=fish.one(this.inputElem).height(),h=fish.one(window).width(),j=this.width;switch(e.showType){case "pop":fish.all(e.__calElem).css("position:static;");
fish.require("mPop",function(){fish.all(e.__calElem).getCss("display")!=="block"&&fish.all(e.__calElem).css("display:block;");fish.mPop({content:e.__calElem,afterClose:function(){fish.all(e.__calElem).css("display:none;")}})});break;case "static":fish.all(e.__calElem).css("position:relative;display:block;left:0;");fish.one(e.inputElem).css("display:block").html("top",e.__calElem);break;default:h=h-g.left>=j+20?g.left:g.left-20-(j-(h-g.left));c=g.top+f;d=h}b||this.set();setTimeout(function(){e.__calElem.css("display:block;top:"+
c+"px;left:"+d+"px")},0)}},hide:function(){switch(this.showType){case "pop":fish.require("mPop",function(){fish.mPop.close()});break;case "static":break;default:this.__calElem.css("display:none")}this.afterClose&&typeof this.afterClose==="function"&&this.afterClose.call(this)},goPrev:function(){this.focus=fish.parseTime(this.focus,{months:-this.monthNum});if(this.monthChangeStyle==="static"){this.setMonth("focus",this.focus);this.setMonthUserDate("focus",this.focus)}else if(this.monthChangeStyle===
"scroll"){var a=fish.parseTime(this.focus,{months:-this.monthNum});this._scrollPrev();this.setMonth("prev",a);this.setMonthUserDate("focus",a)}this.setMonthTitle();this.setMonthBtn();this.afterPrevFn&&this.afterPrevFn.call(this)},goNext:function(){this.focus=fish.parseTime(this.focus,{months:this.monthNum});if(this.monthChangeStyle==="static"){this.setMonth("focus",this.focus);this.setMonthUserDate("focus",this.focus)}else if(this.monthChangeStyle==="scroll"){var a=fish.parseTime(this.focus,{months:this.monthNum});
this._scrollNext();this.setMonth("next",a);this.setMonthUserDate("focus",a)}this.setMonthTitle();this.setMonthBtn();this.afterNextFn&&this.afterNextFn.call(this)},_monthStyle:function(){fish.browser();return function(a){return"left:"+a+"px;top:0px"}}(),_scrollTo:function(a,b){var c=0,d=0,e=this,g=this.monthGroup[a];switch(b){case "prev":c=-this.monthNum;a==="next"?d=0:d=1;break;case "next":c=this.monthNum;a==="prev"?d=0:d=1;break;case "focus":d=2}this.monthGroup[g].forEach(function(f,h){f.css(e._monthStyle((h+
c)*f.width+(h+c)*6));f.z(d)})},_setScroll:function(){this.monthGroup.prev="a";this.monthGroup.focus="b";this.monthGroup.next="c";this._scrollTo("focus","focus");this._scrollTo("next","next");this._scrollTo("prev","prev")},_scrollPrev:function(){var a=this.monthGroup.focus,b=this.monthGroup.prev,c=this.monthGroup.next;this._scrollTo("focus","next");this._scrollTo("next","prev");this._scrollTo("prev","focus");this.monthGroup.focus=b;this.monthGroup.prev=c;this.monthGroup.next=a},_scrollNext:function(){var a=
this.monthGroup.focus,b=this.monthGroup.prev,c=this.monthGroup.next;this._scrollTo("focus","prev");this._scrollTo("next","focus");this._scrollTo("prev","next");this.monthGroup.focus=c;this.monthGroup.prev=a;this.monthGroup.next=b},_setStatic:function(){var a=this;this.monthGroup.focus=this.monthGroup.prev=this.monthGroup.next="b";this.monthGroup.b.forEach(function(b,c){b.css(a._monthStyle(c*b.width+c*5))})},setMonthTitle:function(){var a=this;this.__monthTitleElem.each(function(b,c){var d=fish.parseDate(a.focus,
{months:c}),e;e=d.getFullYear();d=d.getMonth()+1;e=a.calTitleFn&&typeof a.calTitleFn==="function"?a.calTitleFn.call(a,e,d):e+"\u5e74"+d+"\u6708";fish.one(".date_title",b).html(e)})},setMonthBtn:function(){var a=this.focus,b=fish.parseDate(a,{months:-1}),c=b.getMonth()+1,d=fish.parseDate(this.startTime),e=fish.parseDate(this.endTime),g=fish.parseDate(a,{months:this.monthNum});a=g.getMonth()+1;d.setDate(1);e.setDate(1);b=d<=b;e=g<=e;if(this.showMonthOnBtn){this.__prevBtnTips.html(c+"\u6708").css("display:block");
this.__nextBtnTips.html(a+"\u6708").css("display:block")}else{this.__prevBtnTips.css("display:none");this.__nextBtnTips.css("display:none")}if(this.enableBtnWhenOutOfRange){this.__prevBtnTips.removeClass("clickDisable");this.__nextBtnTips.removeClass("clickDisable")}else{b?this.__prevBtn.removeClass("clickDisable"):this.__prevBtn.addClass("clickDisable");e?this.__nextBtn.removeClass("clickDisable"):this.__nextBtn.addClass("clickDisable")}},setAjaxUrl:function(a){this.ajaxUrl=a},getAjaxUrl:function(){return this.ajaxUrl}};
mMonthFn={init:function(){var a=this;if(!this.__elem){this.__elem=y(this.calTemp);this.__itemElems=fish.all(".itemWrap",this.__elem);this.__dateElems=fish.all(".dateWrap",this.__elem);this.__userElems=fish.all(".userWrap",this.__elem);this.__thElems=fish.all("th",this.__elem);this.dateCss&&this.__dateElems.css(this.dateCss);this.userDateCss&&this.__userElems.css(this.userDateCss);this.tableThCss&&this.__thElems.css(this.tableThCss);this.itemCss&&this.__itemElems.css(this.itemCss);this.__itemElems.css("width:"+
this.eachWidth+"px;height:"+this.eachHeight+"px");this.__bgElem=fish.all(".monthBg",this.__elem).css("font-size:"+this.cal.backgroundMonthnumSize+"px");this.firstDay=r(this.month);this.setDate();this.__itemElems.on("click",function(){var b=fish.one(this),c=b.attr("day"),d=b.attr("month"),e=b.attr("year");d=fish.parseDate(e+"-"+d+"-"+c);d.setDate(parseInt(c,10));if(b.hasClass("spanEnable")&&c&&!b.hasClass("clickDisable")){b=fish.parseTime(d);a.fn&&a.fn.call(a,b)}}).hover(function(){var b=fish.one(this),
c=fish.one(this),d=c.attr("day"),e=c.attr("month");c=c.attr("year");e=fish.parseDate(c+"-"+e+"-"+d);c=fish.parseDate(a.month);var g=fish.parseDate(c,{months:-1}),f=fish.parseDate(c,{months:1}),h;if(e.getMonth()==c.getMonth())h=a.formatData;else if(e.getMonth()==g.getMonth())h=a.lastMonthFormatData;else if(e.getMonth()==f.getMonth())h=a.nextMonthFormatData;c=fish.parseTime(e);e.setDate(parseInt(d,10));b.hasClass("spanEnable")&&b.addClass("spanHover");a.mouseover&&a.mouseover.call(a,c,this,h?h[parseInt(d,
10)-1]:undefined)},function(){var b=fish.one(this),c=fish.one(this),d=c.attr("day"),e=c.attr("month");c=c.attr("year");e=fish.parseDate(c+"-"+e+"-"+d);e.setDate(parseInt(d,10));d=fish.parseTime(e);a.mouseout&&a.mouseout.call(a,d);b.hasClass("spanEnable")&&b.removeClass("spanHover")})}},appendTo:function(a){fish.one(a).html("bottom",this.__elem);if(!this.width&&!this.height){this.width=7*(this.cal.eachWidth+2)+7+2;this.height=25+6*(this.cal.eachHeight+2+1)}this.__bgElem.css("width:"+this.width+"px;height:"+
this.height+"px")},insertTo:function(a){fish.one(a).html("top",this.__elem);if(!this.width&&!this.height){this.width=7*(this.cal.eachWidth+2)+7+2;this.height=25+6*(this.cal.eachHeight+2+1)}this.__bgElem.css("width:"+this.width+"px;height:"+this.height+"px;line-height:"+this.height+"px")},css:function(a){this.__elem.css(a)},z:function(a){this.__elem.css("z-index:"+a)},_setValidDate:function(){var a=C(this.month,this.startTime,this.endTime);this.startDate=a.start;this.endDate=a.end},setDate:function(a){a=
a||{};var b=this;fish.lang.extend(this,a);var c=fish.parseDate(this.month);c.setDate(1);this.month=fish.parseTime(c);this.monthIndex=fish.parseDate(this.month).getMonth()+1;this.tomorrow=fish.parseTime(this.today,{days:1});this._setValidDate();var d=r(this.month);a=r(this.month,"number");var e=fish.parseTime(this.month,{months:-1}),g=fish.parseTime(this.month,{months:1}),f,h=0,j="",n=false,s=false,k,l,i,o,q=m(this.month),u=m(e);if(b.fillBlank)if(a==0){h=k=0;f=c}else{k=-1;h=u-a;f=fish.parseDate(e)}else{h=
k=0;f=c}this.__itemElems.each(function(v,t){i=fish.one(b.__itemElems[t]);o=fish.one(b.__dateElems[t]);i.removeClass("spanNow spanDate spanEnable spanHover spanSpec notAble");if(b.fillBlank||(n||fish.one(v).attr("calday")===d)&&!s){n=true;h++;if(b.fillBlank)if(k==-1){if(h>u){k=0;h=1;f=c}}else if(k==0)if(h>q){h=k=1;f=fish.parseDate(g)}f.setDate(h);j=fish.parseTime(f);l=A[fish.parseTime(j)];k!==0?i.addClass("notCurMonthDay"):i.removeClass("notCurMonthDay");if(j===b.today){i.addClass("spanSpec");l={name:"\u4eca\u5929"}}else if(j===
b.tomorrow){i.addClass("spanSpec");l={name:"\u660e\u5929"}}else j===b.now&&i.addClass("spanNow");i.attr("day",h);i.attr("month",f.getMonth()+1);i.attr("year",f.getFullYear());l&&b.cal.showSpecDate?o.html(l.name):o.html(h);i.addClass("spanDate");if(!b.fillBlank&&b.startDate<=h&&h<=b.endDate||b.showPast){i.addClass("spanEnable");l&&i.addClass("spanSpec")}else if(b.fillBlank&&fish.parseTime(f)>=fish.parseTime(b.startTime)&&fish.parseTime(f)<=fish.parseTime(b.endTime)||b.showPast){i.addClass("spanEnable");
l&&i.addClass("spanSpec")}else i.addClass("notAble");if(q===h)s=true}else{o.html("");i.attr("day","")}});this.setNow(this.now);this.__bgElem.html(this.monthIndex)},setNow:function(a){a=a==""?fish.one(this.cal.__inputElem).val():a;var b=fish.parseDate(a),c=fish.parseDate(this.month);this.clearNow();b.getFullYear()===c.getFullYear()&&b.getMonth()===c.getMonth()&&this.__itemElems.each(function(d){d=fish.one(d);if(d.attr("day")==b.getDate()&&d.attr("month")==b.getMonth()+1){d.addClass("spanNow");this.now=
fish.parseTime(a);return false}})},getItemElem:function(a,b){if(a==undefined)throw"param missing!check getItemElem";else if(isNaN(a))throw"param:day should be numberType!check getItemElem";if(b==undefined)throw"param missing!check getItemElem";else if(isNaN(b))throw"param:month should be numberType!check getItemElem";var c;this.__itemElems.each(function(){var d=this.getAttribute("day"),e=this.getAttribute("month");if(a==d&&b==e){c=this;return false}});return c},clearNow:function(){this.__itemElems.removeClass("spanNow");
this.now=""},setUserDate:function(){if(this.dataUrl&&this.processDataFn&&this.dateTempleteFn){var a=this,b,c,d=this.dataUrl,e=fish.parseDate(this.month),g=fish.parseTime(e,{months:-1});g=fish.parseDate(g);m(g);g=fish.parseTime(e,{months:1});g=fish.parseDate(g);m(g);var f=this._getKeyUID(e);d=d.replace(/{month}/g,E(e.getMonth()+1));d=d.replace(/{year}/g,e.getFullYear());d=d.replace("{nextMonth}",g.getMonth()+1);d=d.replace("{nextMonthYear}",g.getFullYear());this.__bgElem.addClass("loadingbg");b=fish.parseDate(a.month);
c=m(b);d=d.replace("{monthDays}",c);this._clearUserDate();if(this.reloadData||!this.cal.cache[f]||!this.cachAjax){if(a.__ajaxObjs[f])try{a.__ajaxObjs[f].abort();a.__ajaxObjs[f]=null}catch(h){}this.__ajaxObjs[f]=fish.ajax({url:d,type:this.type,jsonpCallback:this.jsonpCallback,fn:function(j){a.__ajaxObjs[f]=null;if(j){a.cal.cache[f]=j;a.ajaxFn&&a.ajaxFn(j);a.formatData=a.processDataFn(j,c,b.getFullYear(),b.getMonth()+1);a._setUserDate();if(a.preLoadingUserData){a._fillPrevOrNextMonth(e.getFullYear(),
e.getMonth()+1);a._getPrevAndNextMonthUserDate()}a.__bgElem.removeClass("loadingbg")}}})}else{a.formatData=a.processDataFn(this.cal.cache[f],c,b.getFullYear(),b.getMonth()+1);a._setUserDate();if(a.preLoadingUserData){a._fillPrevOrNextMonth(e.getFullYear(),e.getMonth()+1);a._getPrevAndNextMonthUserDate()}this.__bgElem.removeClass("loadingbg")}}},_getPrevAndNextMonthUserDate:function(){var a=fish.parseDate(this.month),b=fish.parseTime(a,{months:-1});b=fish.parseDate(b);var c=m(b),d=this._getKeyUID(b);
a=fish.parseTime(a,{months:1});a=fish.parseDate(a);var e=m(a),g=this._getKeyUID(a),f=this.cal.cache[d],h=this.cal.cache[g];if(f){if(this.fillBlank){this.lastMonthFormatData=this.processDataFn(f,c,b.getFullYear(),b.getMonth()+1);this._setUserDate("prevMonth")}}else this.__ajaxObjs[d]||this._getMonData(b);if(h){if(this.fillBlank){this.nextMonthFormatData=this.processDataFn(h,e,a.getFullYear(),a.getMonth()+1);this._setUserDate("nextMonth")}}else this.__ajaxObjs[g]||this._getMonData(a)},_getMonData:function(a){var b=
this.dataUrl,c=this._getKeyUID(a),d=this.__ajaxObjs[c],e=a.getFullYear(),g=a.getMonth()+1,f=m(a);a=fish.parseDate(a,{months:1});var h=this;if(d)try{d.abort();d=null}catch(j){}b=b.replace(/month/g,g);b=b.replace(/year/g,e);b=b.replace("{nextMonth}",a.getMonth()+1);b=b.replace("{nextMonthYear}",a.getFullYear());b=b.replace("{monthDays}",f);this.__ajaxObjs[c]=fish.ajax({url:b,type:this.type,jsonpCallback:this.jsonpCallback,fn:function(n){if(n){h.cal.cache[c]=n;h.__ajaxObjs[c]=null;h.fillBlank&&h._fillPrevOrNextMonth(e,
g)}}})},_getKeyUID:function(a){a=fish.parseDate(a);var b=a.getFullYear();a=this._fomateMonth(a.getMonth()+1);return b+"-"+a},_fillPrevOrNextMonth:function(a,b){this.cal.monthGroup[this.cal.monthGroup.focus].forEach(function(c){var d=fish.parseDate(c.month),e=d.getFullYear();d=d.getMonth()+1;c._isPrevOrNextMonth(e,d,a,b)&&c._getPrevAndNextMonthUserDate()})},_isPrevOrNextMonth:function(a,b,c,d){a=parseInt(a);c=parseInt(c);b=parseInt(b);d=parseInt(d);return a==c&&b-d==1?true:a-c==1&&b==1&&d==12?true:
a==c&&d-b==1?true:c-a==1&&d==1&&b==12?true:false},_fomateMonth:function(a){a=parseInt(a);return a<10?"0"+a:a},_clearUserDate:function(){var a=this;this.__userElems.each(function(b,c){fish.one(a.__userElems[c]).html("")})},_setUserDate:function(a){var b=false,c=false,d=this,e,g,f,h=r(this.month),j=r(this.month,"number"),n,s,k,l,i,o,q;k=fish.parseDate(this.month,{months:-1});var u=fish.parseDate(this.month,{months:1}),v=m(this.month),t=m(k);a=a||"currMonth";if(!(j==0&&a=="prevMonth")){switch(a){case "prevMonth":f=
t-j+1;n=d.lastMonthFormatData;break;case "nextMonth":k=u;f=1;n=d.nextMonthFormatData;break;default:case "currMonth":f=1;k=fish.parseDate(this.month);n=d.formatData}o=k.getFullYear();q=k.getMonth()+1;this.__userElems.each(function(I,w){if(!c&&(b||fish.one(I).getParent(".itemWrap").attr("calday")===h&&a=="currMonth"||a=="prevMonth"||w>=v+j&&a=="nextMonth")){b=true;l=fish.parseTime([o,q,f].join("-"));i=A[fish.parseTime(l)];s=l>=d.startTime&&l<=d.endTime;if(l===d.today)i={name:"\u4eca\u5929"};else if(l===
d.tomorrow)i={name:"\u660e\u5929"};g=d.dateTempleteFn(o,q,f,n[f-1],i,s);if(d.dateClickAbleFn)e=d.dateClickAbleFn(o,q,f,n[f-1],i);fish.one(d.__userElems[w]).html(g?g:"");f++;if(e===false||g===false)fish.one(d.__itemElems[w]).removeClass("spanEnable");if(v<f&&a=="currMonth"||t<f&&a=="prevMonth")c=true}else a=="currMonth"&&!d.fillBlank&&fish.one(d.__userElems[w]).html("")})}}};var B=true;fish.extend({mCal:function(){var a=arguments;if(B){a=z.apply(this,a);B=false}else a=z.apply(this,a);return a},preventInput:function(a){fish.all(a?
a:this).each(function(b){if(!b.getAttribute("_preventInput_")){b.style.imeMode="disabled";b.onkeydown=function(c){fish.preventDefault(c)};b.oncontextmenu=function(){return false};b.onselectstart=function(){return false};b.setAttribute("_preventInput_","true")}})},recoverInput:function(a){fish.all(a?a:this).each(function(b){if(b.getAttribute("_preventInput_")){b.style.imeMode="";b.onkeydown=b.oncontextmenu=b.onselectstart=null;b.setAttribute("_preventInput_","")}})}})})();
